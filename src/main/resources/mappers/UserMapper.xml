<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gec.dao.UserMapper">
    <!--Page<UserBO> getList(
         Page page,
         @Param("param") Map<String,Object> param );
     -->
    <select id="getList" resultType="com.gec.domain.bo.UserBO">
        SELECT
        <include refid="list_fields"/>
        FROM tbl_user u
        LEFT JOIN tbl_dept d ON u.dept_id=d.id
        LEFT JOIN tbl_user_role ur ON ur.user_id=u.id
        LEFT JOIN tbl_role r ON ur.role_id=r.id
        <include refid="list_where"/>
        ORDER  BY u.id
    </select>

    <sql id="list_fields">
        u.id, u.account, u.nick_name,
        u.phone, u.sex, u.no,
        r.id roleId, r.role_name roleName,
        u.dept_id, d.dept_name,
        u.create_date, u.update_date
    </sql>

    <sql id="list_where">
        <where>
            u.account != "admin"
            <if test="param.account!=null">
                and u.account LIKE CONCAT("%",#{param.account},"%")
            </if>
            <if test="param.deptId!=null">
                and u.dept_id = #{param.deptId}
            </if>
            <if test="param.roleId!=null">
                and ur.role_id = #{param.roleId}
            </if>
        </where>
    </sql>

</mapper>
